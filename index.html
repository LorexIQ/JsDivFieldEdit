<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>

  <link rel="stylesheet" href="fonts/fontAwesome/css/font-awesome.min.css">
</head>

<style lang="scss">
  :root {
    --main-grid-max-size: 3040px;
    --main-grid-min-size: 500px;
    --main-grid-scale: 1;
  }

  @keyframes errorAddCircle {
    from {
      fill: #868686;
    }
    50% {
      fill: #ff3b6b;
    }
    to {
      fill: #868686;
    }
  }
  @keyframes errorAddDiv {
    from {
      transform: scale(1);
    }
    50% {
      transform: scale(1.1);
    }
    to {
      transform: scale(1);
    }
  }

  .error-add {
    animation-name: errorAddDiv;
    animation-duration: 0.3s;
  }
  .error-add>svg>circle {
    animation-name: errorAddCircle;
    animation-duration: 0.3s;
  }

  @keyframes successAddCircle {
    from {
      fill: #868686;
    }
    50% {
      fill: #2ab99d;
    }
    to {
      fill: #868686;
    }
  }
  @keyframes successAddDiv {
    from {
      transform: scale(1);
    }
    50% {
      transform: scale(1.1);
    }
    to {
      transform: scale(1);
    }
  }

  .success-add {
    animation-name: successAddDiv;
    animation-duration: 0.3s;
  }
  .success-add>svg>circle {
    animation-name: successAddCircle;
    animation-duration: 0.3s;
  }

  body, html {
    height: 100%;
    margin: 0;

    background-color: #ffffff;
  }

  #field {
    width: 500px;
    height: 500px;

    overflow: hidden;
    position: relative;
  }

  .block-btn {
    display: flex;
    flex-direction: column;
  }

  .points {
    position: absolute;
    left: 10px;
    top: 10px;
  }

  .zoom {
    position: absolute;
    right: 10px;
    top: calc(50% - 70px);
  }

  .center {
    position: absolute;
    right: 10px;
    bottom: 10px;
  }

  .add-check {
    z-index: 1001;
  }
  .custom-checkbox {
    position: absolute;
    z-index: -1;
    opacity: 0;
  }
  .custom-checkbox+label {
    display: inline-flex;
    align-items: center;
    user-select: none;
  }
  .custom-checkbox+label::before {
    font-family: 'FontAwesome',serif;
    color: #fff;
    background-color: #bbb;
    box-shadow: 0 0 12px 2px #bababa;

    width: 40px;
    height: 40px;
    margin-bottom: 10px;
    flex-shrink: 0;
    flex-grow: 0;
    border: 0;
    border-radius: 10px;

    display: flex;
    justify-content: center;
    align-items: center;

    transition: 0.3s;
  }
  .custom-checkbox:checked+label::before {
    background-color: #868686;
    transform: scale(0.95);
  }

  #add+label::before {
    content: '\f041';
  }

  #del+label::before {
    content: '\f00d';
  }
  
  .btn {
    width: 40px;
    height: 40px;

    background-color: #bababa;
    border: 0;
    border-radius: 10px;
    margin: 0 0 10px 0;

    transition: 0.3s;

    box-shadow: 0 0 12px 2px #bababa;
  }

  .btn:last-child {
    margin: 0;
  }

  .btn:hover {
    background-color: #868686;
  }

  .btn:active {
    background-color: #666;
    transform: scale(0.95);
  }

  .btn>p {
    margin: 0;
    font-size: 18px;
    color: #fff;
  }

  .point {
    position: absolute;
    z-index: 1000;
    visibility: hidden;
    cursor: none;
    width: 20px;
    height: 20px;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .point>svg {
    border-radius: 100%;
    box-shadow: 0 0 10px 2px #bbb;
  }

  #gridField {
    width: var(--main-grid-max-size);
    height: var(--main-grid-max-size);

    background: 0 calc(var(--main-grid-max-size) / 2) url("data:image/svg+xml,%3Csvg width='40' height='2' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M 40,0 L 0,0' fill='transparent' stroke='%23989898'/%3E%3C/svg%3E") repeat-x,
    calc(var(--main-grid-max-size) / 2) 0 url("data:image/svg+xml,%3Csvg width='2' height='40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M 0,40 L 0,0' fill='transparent' stroke='%23989898'/%3E%3C/svg%3E") repeat-y,
    url("data:image/svg+xml,%3Csvg version='1.1' baseProfile='full' width='40' height='40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M 0,40 L 0,0 40,0' fill='transparent' stroke='%23e3e4e6'/%3E%3C/svg%3E"),
    #f8faff;

    position: absolute;
    transform: scale(var(--main-grid-scale));
    transform-origin: left top;
  }
</style>

<body>
<div id="field">
  <div id="point-add" class="point" onclick="addPointInField()">
    <svg width="20" height="20"
         xmlns="http://www.w3.org/2000/svg">
      <circle cx="10" cy="10" r="10" fill="#868686" id="pointer-adder" />
    </svg>
  </div>
  <div id="point-del" style="color: #868686;" class="point" onclick="delPointFromField()">
    <p class="fa fa-times"></p>
  </div>
  <div draggable="true" id="gridField">
    <svg xmlns="http://www.w3.org/2000/svg" id="content" />
  </div>
  <div class="block-btn points">
    <div class="add-check">
      <input type="checkbox" id="add" class="custom-checkbox" onchange="addPoint()">
      <label for="add"></label>
    </div>
    <div class="add-check">
      <input type="checkbox" id="del" class="custom-checkbox" onchange="delPoint()">
      <label for="del"></label>
    </div>
  </div>
  <div class="block-btn zoom">
    <button onclick="zoomUp()" class="btn">
      <p class="fa fa-plus"></p>
    </button>
    <button onclick="reloadZoom()" class="btn">
      <p>1:1</p>
    </button>
    <button onclick="zoomDown()" class="btn">
      <p class="fa fa-minus"></p>
    </button>
  </div>
  <div class="block-btn center">
    <button onclick="centred()" class="btn">
      <p class="fa fa-crosshairs"></p>
    </button>
  </div>
</div>
</body>

<script>
  let scaleValue = 1;
  const maxScale = 3;
  const maxSize = 3040;
  const minSize = 500;
  let added = false;
  let deleted = false;
  let drag = true;
  let arrayPoints = []
  let currentId = 0;

  centred();

  let content = document.getElementById('content');
  content.style.width = maxSize + 'px';
  content.style.height = maxSize + 'px';

  let tasksListElement = document.getElementById('gridField');
  let pointer = document.getElementById('point-add');
  let deleter = document.getElementById('point-del');
  tasksListElement.onmousedown = function (event) {
    if (drag) {
      unActiveAllPoints();
      const pos_div = tasksListElement.getBoundingClientRect();
      const first_pos = {
        x: event.clientX,
        y: event.clientY
      };
      function onMouseMove (event_move) {
        const deviation_value = {
          width: event_move.clientX - first_pos.x,
          height: event_move.clientY - first_pos.y
        };
        tasksListElement.style.left = pos_div.x + deviation_value.width + 'px';
        tasksListElement.style.top = pos_div.y + deviation_value.height + 'px';

        fixedPosition();
      }
      document.addEventListener('mousemove', onMouseMove);
      tasksListElement.onmouseout = function() {
        document.removeEventListener('mousemove', onMouseMove);
        tasksListElement.onmouseup = null;
      };
      tasksListElement.onmouseup = function() {
        document.removeEventListener('mousemove', onMouseMove);
        tasksListElement.onmouseup = null;
      };
    }
  }
  tasksListElement.ondragstart = function () {
    return false;
  }
  tasksListElement.onmousemove = function (event) {
    if (added) {
      movePointer(event);
    } else if (deleted) {
      moveDeleter(event);
    }
  }
  pointer.onmousemove = function (event) {
    movePointer(event)
  }
  deleter.onmousemove = function (event) {
    moveDeleter(event)
  }

  function addPointInField () {
    const rectPointer = pointer.getBoundingClientRect();
    const rectField = tasksListElement.getBoundingClientRect();
    const coords = {
      x: (rectPointer.x + 10 - rectField.x) / scaleValue,
      y: (rectPointer.y + 10 - rectField.y) / scaleValue
    }
    if (arrayPoints.length !== 0) {
      for (let point of arrayPoints) {
        if (Math.abs(point.x - coords.x) < 30 && Math.abs(point.y - coords.y) < 30) {
          pointer.classList.add('error-add');
          setTimeout(() => {
            pointer.classList.remove('error-add');
          }, 300);
          return;
        }
      }
    }
    pointer.classList.add('success-add');
    setTimeout(() => {
      pointer.classList.remove('success-add');
    }, 300);
    content.insertAdjacentHTML('beforeend', `<circle cx="${coords.x}" cy="${coords.y}" r="10" fill="#868686" class="fieldPoint" style="transition: 0.3s" id="point-${currentId}" onclick="selectPoint(${currentId})" onmouseover="blockDrag(true)" onmouseout="blockDrag(false)"/>"`);
    arrayPoints.push({
      id: currentId,
      x: coords.x,
      y: coords.y
    });
    currentId += 1;
  }
  function delPointFromField () {

  }
  function unActiveAllPoints () {
    for (let point of document.querySelectorAll('.fieldPoint')) {
      point.style.fill = "#868686";
    }
  }
  function blockDrag (mode) {
    drag = !mode;
  }
  function selectPoint (id) {
    unActiveAllPoints();
    let point = document.getElementById(`point-${id}`);
    point.style.fill = "#ff3b6b";
  }
  function movePointer (event) {
    if (added) {
      const coords = {
        x: event.clientX,
        y: event.clientY
      }

      pointer.style.left = coords.x - 10 + 'px';
      pointer.style.top = coords.y - 10 + 'px';
    }
  }
  function moveDeleter (event) {
    if (deleted) {
      const coords = {
        x: event.clientX,
        y: event.clientY
      }

      deleter.style.left = coords.x - 10 + 'px';
      deleter.style.top = coords.y - 10 + 'px';
    }
  }
  function addPoint () {
    if (deleted) {
      document.getElementById('del').checked = false;
      delPoint();
    }
    unActiveAllPoints();
    added = document.getElementById('add').checked;
    if (added) {
      pointer.style.visibility = "visible";
    } else {
      pointer.style.visibility = "hidden";
    }
  }
  function delPoint () {
    if (added) {
      document.getElementById('add').checked = false;
      addPoint();
    }
    unActiveAllPoints();
    deleted = document.getElementById('del').checked;
    if (deleted) {
      deleter.style.visibility = "visible";
    } else {
      deleter.style.visibility = "hidden";
    }
  }
  function setScale (value = 1, editor = 0) {
    scaleValue = value + editor
    document.documentElement.style.setProperty('--main-grid-scale', '' + scaleValue);
  }
  function updateScale () {
    scaleValue = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--main-grid-scale'));
  }
  function reloadZoom () {
    setScale ();
    centred ();
  }
  function zoomUp () {
    updateScale ();
    if (scaleValue + 0.1 > maxScale) return;

    const oldRect = tasksListElement.getBoundingClientRect();

    setScale(scaleValue, 0.1);

    const newRect = tasksListElement.getBoundingClientRect();
    tasksListElement.style.left = newRect.x - (newRect.width - oldRect.width) / 2 + 'px';
    tasksListElement.style.top = newRect.y - (newRect.width - oldRect.width) / 2 + 'px';
  }
  function zoomDown () {
    updateScale ();
    if ((scaleValue - 0.1) * maxSize < minSize) return;

    const oldRect = tasksListElement.getBoundingClientRect();

    setScale(scaleValue, -0.1);

    const newRect = tasksListElement.getBoundingClientRect();
    tasksListElement.style.left = newRect.x - (newRect.width - oldRect.width) / 2 + 'px';
    tasksListElement.style.top = newRect.y - (newRect.width - oldRect.width) / 2 + 'px';

    fixedPosition();
  }
  function centred () {
    updateScale ()
    let grid_elem = document.getElementById('gridField');
    grid_elem.style.left = -(maxSize * scaleValue - minSize) / 2 + 'px';
    grid_elem.style.top = -(maxSize * scaleValue - minSize) / 2 + 'px';
  }
  function fixedPosition () {
    let grid_elem = document.getElementById('gridField');
    let pos_div = grid_elem.getBoundingClientRect();

    if (pos_div.right < minSize)
      grid_elem.style.left = pos_div.x + (minSize - pos_div.right) + 'px';
    if (pos_div.bottom < minSize)
      grid_elem.style.top = pos_div.y + (minSize - pos_div.bottom) + 'px';
    if (pos_div.x > 0)
      grid_elem.style.left = '0px';
    if (pos_div.y > 0)
      grid_elem.style.top = '0px';
  }
</script>
</html>
